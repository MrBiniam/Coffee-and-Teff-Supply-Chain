<section class="content">
  <div class="container-fluid">
    <div class="block-header">
      <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
          <ul class="breadcrumb breadcrumb-style ">
            <li class="breadcrumb-item">
              <h4 class="page-title">Orders</h4>
            </li>
            <li class="breadcrumb-item bcrumb-1">
              <a routerLink="/doctor/dashboard">
                <i class="fas fa-home"></i> Home</a>
            </li>
            <li class="breadcrumb-item active">Orders</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="row clearfix">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
          <div class="header">
            <h2><strong>Pending</strong> Orders</h2>
            <button mat-mini-fab color="primary" class="float-right" (click)="refreshOrders()" matTooltip="Refresh Orders">
              <i class="material-icons">refresh</i>
            </button>
          </div>
          <div class="body">
            <!-- Loading indicator -->
            <div *ngIf="isLoading" class="row justify-content-center py-5">
              <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
              </div>
              <h4 class="ml-2">Loading buyer information...</h4>
            </div>

            <!-- Show when no orders are available -->
            <div *ngIf="!isLoading && orders.length === 0" class="row">
              <div class="col-12">
                <div class="card p-5" style="text-align: center;">
                  <div style="padding: 30px;">
                    <i class="material-icons" style="font-size: 60px; color: #fb8c00; margin-bottom: 20px;">inbox</i>
                    <h3 style="color: #555;">No Pending Orders Available</h3>
                    <p style="color: #777;">There are no pending orders in the system that need your approval at this time.</p>
                    <button mat-raised-button (click)="refreshOrders()" style="margin-top: 20px; background: linear-gradient(60deg, #ec407a, #d81b60); color: white; box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.14), 0 7px 10px -5px rgba(233, 30, 99, 0.4);">
                      <i class="material-icons" style="margin-right: 5px;">refresh</i> Refresh Orders
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Orders List -->
            <div *ngIf="!isLoading && orders.length > 0" class="row">
              <div class="col-12" *ngFor="let order of orders">
                <div class="card p-3">
                  <div class="row">
                    <!-- Buyer and Product Photos - Vertically Stacked -->
                    <div class="col-12 col-md-2 mb-0">
                      <div class="photo-container">
                        <!-- Rectangular Buyer Image -->
                        <div class="buyer-image-container" style="margin-bottom: 10px; text-align: center;">
                          <img class="buyer-image" 
                            [src]="order.buyerImageUrl || 'assets/images/user/default.png'" 
                            onerror="this.src='assets/images/user/default.png'"
                            style="width: 100px; height: 120px; border-radius: 8px; object-fit: cover; border: 3px solid #4CAF50;">
                        </div>
                        <!-- Smaller Circular Product Image Below Buyer -->
                        <div class="product-circular-container" style="text-align: center; margin-top: 5px;">
                          <img class="product-circular-image" 
                            [src]="'http://127.0.0.1:8000/media/Products_Pictures/' + (order.product[0].image.split('/').pop())" 
                            onerror="this.src='assets/images/products/p-13.jpg'"
                            style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #FFA000;">
                        </div>
                      </div>
                    </div>
                    
                    <!-- Buyer Information -->
                    <div class="col-md-6 border-right mb-0">
                      <div class="doc-card-title">
                        <!-- Colored Buyer Name for Better Visibility -->
                        <h4 style="color: #2196F3; font-weight: bold; margin-bottom: 10px;">{{order.buyerName || 'Customer'}}</h4>
                      </div>
                      <div class="d-flex flex-row align-items-center mb-2">
                        <span class="mr-1">Reliability Rating: </span>
                        <div class="stars">
                          <i *ngFor="let star of getBuyerRating(order)" class="fas fa-star col-orange"></i>
                          <i *ngFor="let emptyStar of getEmptyStars(order)" class="far fa-star col-orange"></i>
                        </div>
                      </div>
                      <div class="buyer-details">
                        <p><strong>Ordered Product:</strong> {{order.product[0].name}} ({{order.product[0].product_type}})</p>
                        <p><strong>Amount Paid:</strong> {{order.quantity * order.product[0].price | currency:'ETB '}}</p>
                      </div>
                    </div>
                    
                    <!-- Order Details -->
                    <div class="d-flex col-md-4 mb-0">
                      <div class="d-flex flex-column justify-content-start user-profile w-100">
                        <div><i class="far fa-comment-dots pt-3 pr-3"></i> Quantity: {{order.quantity}} </div>
                        <div><i class="far fa-money-bill-alt pt-3 pr-3"></i> Price per Unit: {{order.product[0].price}}</div>
                        <div><i class="far fa-clock pt-3 pr-3"></i> Date: {{order.order_date | date: 'MM/dd/yyyy'}}</div>
                        <div class="mt-3">
                          <button mat-raised-button color="accent" (click)="acceptOrder(order.id)" style="background: linear-gradient(60deg, #ffa726, #fb8c00); color: white; box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.14), 0 7px 10px -5px rgba(255, 152, 0, 0.4);">Accept Order</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
