<section class="content">
  <div class="container-fluid">
    <div class="block-header">
      <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
          <ul class="breadcrumb breadcrumb-style ">
            <li class="breadcrumb-item">
              <h4 class="page-title">Orders</h4>
            </li>
            <li class="breadcrumb-item bcrumb-1">
              <a routerLink="/driver/dashboard">
                <i class="fas fa-home"></i> Home</a>
            </li>
            <li class="breadcrumb-item active">Delivered Orders</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="row clearfix">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
          <!-- Complete header redesign with important CSS rules -->
          <div style="background: linear-gradient(45deg, #4CAF50, #8BC34A); padding: 20px; border-radius: 8px 8px 0 0; text-align: center !important; width: 100% !important; display: block !important;">
            <i class="fas fa-check-circle" style="font-size: 48px; color: white; margin: 0 auto 15px auto; display: block !important; text-align: center !important;"></i>
            <h2 style="color: white; font-weight: 700; font-size: 28px; margin-bottom: 5px; text-align: center !important; width: 100% !important; display: block !important;">Delivery on point!</h2>
            <p style="color: white; font-weight: 400; font-size: 16px; text-align: center !important; width: 100% !important; margin: 0 auto !important; max-width: 600px !important; display: block !important;">You've successfully delivered this order to its destination!</p>
          </div>
          
          <div class="body">
            <div class="row" *ngFor="let order of orders">
              <div class="col-12">
                <div class="card p-3">
                  <div class="row">
                    <!-- LEFT SIDE: Product image and Order Details -->
                    <div class="col-md-6">
                      <div class="row">
                        <!-- Product image -->
                        <div class="col-12 col-md-5 mb-0">
                          <div style="text-align: center; padding: 10px;">
                            <img class="product-image shadow" 
                                style="width: 180px; height: 150px; object-fit: cover; border-radius: 8px; border: 2px solid #eaeaea;" 
                                src="http://127.0.0.1:8000/{{order.product[0].image?.includes('http://127.0.0.1:8000/') ? order.product[0].image.substring(21) : order.product[0].image}}"
                                alt="{{order.product[0].name}}"
                                (error)="handleImageError($event)">
                          </div>
                        </div>
                        
                        <!-- Order details -->
                        <div class="col-md-7 mb-0">
                          <div class="doc-card-title">
                            <h4 style="font-size: 22px; color: #3f51b5; font-weight: 600; margin-bottom: 15px;">{{order.product[0].name}}</h4>
                          </div>
                          
                          <!-- Order details with consistent formatting -->
                          <div class="order-details">
                            <div class="mb-2"><strong>Type:</strong> {{order.product[0].product_type}}</div>
                            <div class="mb-2"><strong>Quantity:</strong> {{order.quantity}}</div>
                            <div class="mb-2"><strong>Price per Unit:</strong> {{order.product[0].price}}</div>
                            <div class="mb-2"><strong>Total Price:</strong> {{(+order.quantity) * order.product[0].price || order.product[0].price}}</div>
                            <div class="mb-2"><strong>Order Date:</strong> {{order.order_date | date: 'MM/dd/yyyy'}}</div>
                            <div class="mb-2" *ngIf="order.shipped_date"><strong>Shipped Date:</strong> {{order.shipped_date | date: 'MM/dd/yyyy'}}</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- RIGHT SIDE: Stakeholders, Vertical Line, and Delivery Status -->
                    <div class="col-md-6">
                      <div class="row">
                        <!-- Stakeholders - Vertical Layout -->
                        <div class="col-md-4 mb-0 d-flex align-items-center">
                          <div class="stakeholder-container" style="display: flex; flex-direction: column; height: 100%; justify-content: space-between; width: 100%;">
                            
                            <!-- Seller Information - Top -->
                            <div class="stakeholder-card text-center mb-3">
                              <div class="stakeholder-circle">
                                <div style="width: 60px; height: 60px; border-radius: 50%; border: 3px solid #FF9800; margin: 0 auto; overflow: hidden; background-color: #FFF3E0; display: flex; align-items: center; justify-content: center;">
                                  <img *ngIf="order.seller_username" 
                                      [src]="getUserImageUrl(order.seller_username, 'seller')"
                                      style="width: 100%; height: 100%; object-fit: cover;"
                                      (error)="handleImageError($event)">
                                  <i class="fas fa-store" style="font-size: 30px; color: #FF9800; display: none;"></i>
                                </div>
                                <h6 class="mt-1" style="font-size: 12px; margin-bottom: 0;">Seller</h6>
                                <p style="font-size: 11px; margin-bottom: 0;">{{ order.seller_username || 'Unknown' }}</p>
                              </div>
                            </div>
                            
                            <!-- Driver Information - Middle -->
                            <div class="stakeholder-card text-center mb-3">
                              <div class="stakeholder-circle">
                                <div style="width: 60px; height: 60px; border-radius: 50%; border: 3px solid #4CAF50; margin: 0 auto; overflow: hidden; background-color: #E8F5E9; display: flex; align-items: center; justify-content: center;">
                                  <img *ngIf="order.driver_username" 
                                      [src]="getUserImageUrl(order.driver_username, 'driver')"
                                      style="width: 100%; height: 100%; object-fit: cover;"
                                      (error)="handleImageError($event)">
                                  <i class="fas fa-truck" style="font-size: 30px; color: #4CAF50; display: none;"></i>
                                </div>
                                <h6 class="mt-1" style="font-size: 12px; margin-bottom: 0;">Driver</h6>
                                <p style="font-size: 11px; margin-bottom: 0;">{{ order.driver_username || 'You' }}</p>
                              </div>
                            </div>
                            
                            <!-- Buyer Information - Bottom -->
                            <div class="stakeholder-card text-center">
                              <div class="stakeholder-circle">
                                <div style="width: 60px; height: 60px; border-radius: 50%; border: 3px solid #3f51b5; margin: 0 auto; overflow: hidden; background-color: #E8EAF6; display: flex; align-items: center; justify-content: center;">
                                  <img *ngIf="order.buyer_username" 
                                      [src]="getUserImageUrl(order.buyer_username, 'buyer')"
                                      style="width: 100%; height: 100%; object-fit: cover;"
                                      (error)="handleImageError($event)">
                                  <i class="fas fa-user" style="font-size: 30px; color: #3f51b5; display: none;"></i>
                                </div>
                                <h6 class="mt-1" style="font-size: 12px; margin-bottom: 0;">Buyer</h6>
                                <p style="font-size: 11px; margin-bottom: 0;">{{ order.buyer_username || 'Customer' }}</p>
                              </div>
                            </div>
                          </div>
                        </div>
                        
                        <!-- Vertical Line -->
                        <div class="col-md-1 d-flex justify-content-center">
                          <div style="width: 2px; height: 90%; background-color: #e0e0e0; margin: auto;"></div>
                        </div>
                        
                        <!-- Delivery Status -->
                        <div class="col-md-7 d-flex align-items-center">
                          <div class="delivery-success p-3" style="background: linear-gradient(120deg, #e8f5e9, #c8e6c9); border-radius: 12px; border-left: 5px solid #4CAF50; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2); width: 100%;">
                            <div class="text-center">
                              <i class="fas fa-box-open" style="font-size: 32px; color: #2e7d32; margin-bottom: 10px;"></i>
                              <h5 style="color: #2e7d32; font-weight: 700; font-size: 20px; margin-bottom: 8px;">Delivery Completed</h5>
                              <div style="width: 50px; height: 4px; background: #4CAF50; margin: 0 auto 15px auto; border-radius: 2px;"></div>
                              <p style="color: #388e3c; font-size: 14px;">You've successfully delivered this order to its destination!</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
            
          <!-- Thank you message and Dashboard Button at bottom -->
          <div class="text-center mt-4 mb-3 exit-section" style="padding: 20px; background: linear-gradient(to right, #e0f7fa, #b2ebf2); border-radius: 8px;">
            <h4 style="color: #00796b; margin-bottom: 15px;">Great work! Ready for the next delivery?</h4>
            <button mat-raised-button color="primary" routerLink="/app/driver/dashboard" style="padding: 8px 30px;">
              <i class="fas fa-home mr-2"></i> Back to Dashboard
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
